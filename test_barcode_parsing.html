<!DOCTYPE html>
<html>
<head>
    <title>Barcode Parsing Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        input { width: 300px; padding: 8px; margin: 5px 0; font-size: 14px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .field-group { margin: 10px 0; }
        label { display: inline-block; width: 150px; font-weight: bold; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üî¨ Barcode Parsing Test</h1>

        <h2>Test Barcode Data:</h2>
        <div class="info">
            <strong>Format:</strong> PCN|Job|MPN|PartNumber|QTY|PO|Location|PCBType|DateCode|MSD<br>
            <strong>Test Data:</strong> <code id="testBarcodeData">43285|TEST-012|MON38|TEST-012|111|POTEST61|||284-38|Level 1</code>
        </div>

        <h2>Mock Form Fields:</h2>
        <div class="field-group">
            <label>PCN:</label><input type="text" id="pcnInput" readonly>
        </div>
        <div class="field-group">
            <label>Part Number:</label><input type="text" id="partNumberInput" readonly>
        </div>
        <div class="field-group">
            <label>MPN:</label><input type="text" id="mpnInput" readonly>
        </div>
        <div class="field-group">
            <label>Quantity:</label><input type="text" id="quantity" readonly>
        </div>
        <div class="field-group">
            <label>PO:</label><input type="text" id="poInput" readonly>
        </div>
        <div class="field-group">
            <label>Location:</label><input type="text" id="location" readonly>
        </div>
        <div class="field-group">
            <label>PCB Type:</label><input type="text" id="pcb_type" readonly>
        </div>
        <div class="field-group">
            <label>Date Code:</label><input type="text" id="dc" readonly>
        </div>
        <div class="field-group">
            <label>MSD:</label><input type="text" id="msd" readonly>
        </div>

        <button onclick="runTest()">‚ñ∂Ô∏è Run Barcode Parsing Test</button>

        <h2>Test Results:</h2>
        <div id="results"></div>
    </div>

    <script>
        // COPY OF ACTUAL PARSING FUNCTION FROM STOCK.HTML
        function parseAndFillBarcode(code) {
            console.log('üîç PARSING BARCODE');
            console.log('Raw barcode data:', code);
            console.log('Barcode length:', code.length);
            console.log('Contains pipe |?:', code.includes('|'));

            try {
                let parts = [];
                if (code.includes('|')) {
                    parts = code.split('|');
                }

                if (parts.length >= 2) {
                    console.log('Found delimited data:', parts);

                    // Check if this is our standardized format: PCN|Job|MPN|PartNumber|QTY|PO|Location|PCBType|DateCode|MSD
                    if (code.includes('|') && parts.length >= 5) {
                        console.log('üì¶ Detected standardized PCN barcode format!');
                        // Direct mapping
                        const pcn = parts[0] ? parts[0].trim().padStart(5, '0') : '';
                        const job = parts[1] ? parts[1].trim() : '';
                        const mpn = parts[2] ? parts[2].trim() : '';
                        const partNumber = parts[3] ? parts[3].trim() : '';
                        const quantity = parts[4] ? parts[4].trim() : '';
                        const po = parts[5] ? parts[5].trim() : '';
                        const location = parts[6] ? parts[6].trim() : '';
                        const pcbType = parts[7] ? parts[7].trim() : '';
                        const dateCode = parts[8] ? parts[8].trim() : '';
                        const msd = parts[9] ? parts[9].trim() : '';

                        console.log('‚úÖ Parsed data:', {pcn, job, mpn, partNumber, quantity, po, location, pcbType, dateCode, msd});

                        // Fill ALL form fields directly
                        if (pcn) document.getElementById('pcnInput').value = pcn;
                        if (job || partNumber) document.getElementById('partNumberInput').value = job || partNumber;
                        if (mpn) document.getElementById('mpnInput').value = mpn;
                        if (quantity) document.getElementById('quantity').value = quantity;
                        if (po) document.getElementById('poInput').value = po;
                        if (location) document.getElementById('location').value = location;
                        if (pcbType) document.getElementById('pcb_type').value = pcbType;
                        if (dateCode) document.getElementById('dc').value = dateCode;
                        if (msd) document.getElementById('msd').value = msd;

                        console.log('üéâ ALL FIELDS FILLED from barcode!');
                        return true;
                    }
                }

                return false;
            } catch (error) {
                console.error('Error parsing barcode:', error);
                return false;
            }
        }

        function runTest() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            // Clear all fields first
            document.getElementById('pcnInput').value = '';
            document.getElementById('partNumberInput').value = '';
            document.getElementById('mpnInput').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('poInput').value = '';
            document.getElementById('location').value = '';
            document.getElementById('pcb_type').value = '';
            document.getElementById('dc').value = '';
            document.getElementById('msd').value = '';

            // Get test barcode data
            const testData = document.getElementById('testBarcodeData').textContent;

            resultsDiv.innerHTML += '<div class="info"><strong>Testing barcode:</strong> ' + testData + '</div>';

            // Run the parsing function
            const success = parseAndFillBarcode(testData);

            // Verify results
            const tests = [
                { field: 'PCN', id: 'pcnInput', expected: '43285' },
                { field: 'Part Number', id: 'partNumberInput', expected: 'TEST-012' },
                { field: 'MPN', id: 'mpnInput', expected: 'MON38' },
                { field: 'Quantity', id: 'quantity', expected: '111' },
                { field: 'PO', id: 'poInput', expected: 'POTEST61' },
                { field: 'Date Code', id: 'dc', expected: '284-38' },
                { field: 'MSD', id: 'msd', expected: 'Level 1' }
            ];

            let allPassed = true;
            tests.forEach(test => {
                const actualValue = document.getElementById(test.id).value;
                const passed = actualValue === test.expected;
                allPassed = allPassed && passed;

                const resultClass = passed ? 'success' : 'fail';
                const icon = passed ? '‚úÖ' : '‚ùå';
                resultsDiv.innerHTML += `<div class="test-result ${resultClass}">
                    ${icon} <strong>${test.field}:</strong> Expected "${test.expected}", Got "${actualValue}"
                </div>`;
            });

            // Final result
            if (allPassed) {
                resultsDiv.innerHTML += '<div class="test-result success"><strong>üéâ ALL TESTS PASSED!</strong> Barcode auto-fill works perfectly!</div>';
            } else {
                resultsDiv.innerHTML += '<div class="test-result fail"><strong>‚ùå SOME TESTS FAILED!</strong> Check the parsing logic.</div>';
            }
        }

        // Auto-run test on page load
        window.addEventListener('load', function() {
            setTimeout(runTest, 500);
        });
    </script>
</body>
</html>
